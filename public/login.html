<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/8.6.3/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.6.3/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.6.3/firebase-database.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer"
    />
    <style media="screen">
        body {
            background: #ECEFF1;
            color: rgba(0, 0, 0, 0.87);
            font-family: Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        #message {
            background: white;
            max-width: 360px;
            margin: 100px auto 16px;
            padding: 32px 24px;
            border-radius: 3px;
        }
        
        #message h2 {
            color: #ffa100;
            font-weight: bold;
            font-size: 16px;
            margin: 0 0 8px;
        }
        
        #message h1 {
            font-size: 22px;
            font-weight: 300;
            color: rgba(0, 0, 0, 0.6);
            margin: 0 0 16px;
        }
        
        #message p {
            line-height: 140%;
            margin: 16px 0 24px;
            font-size: 14px;
        }
        
        #message a {
            display: block;
            text-align: center;
            background: #039be5;
            text-transform: uppercase;
            text-decoration: none;
            color: white;
            padding: 16px;
            border-radius: 4px;
        }
        
        #message,
        #message a {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }
        
        #load {
            color: rgba(0, 0, 0, 0.4);
            text-align: center;
            font-size: 13px;
        }
        
        @media (max-width: 600px) {
            body,
            #message {
                margin-top: 0;
                background: white;
                box-shadow: none;
            }
            body {
                border-top: 16px solid #ffa100;
            }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.1/html5-qrcode.min.js" integrity="sha512-JXdlXFkKGAhP2yUubNT7hXNjEtPrAJz1Gs7oztdP47KhqL5ux88uof5FnIm2D0Ud/TdqiAe1mM1179kJDy/HKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        const html5QrCode = new Html5Qrcode("reader");
        var stopping = false;
        const qrCodeSuccessCallback = message => { // handle the scanned code as you like, for example:
            if (!stopping) {
                stopCamera()
                stopping = true;
                console.log(`QR matched = ${message}`);
                let listItem = document.createElement('ons-list-item')
                listItem.innerHTML = message;
                document.querySelector('#scanned-list').appendChild(listItem);

                let user = JSON.parse(localStorage.getItem("user"));
                // Create a new post reference with an auto-generated id
                var codesRef = firebase.database().ref('codes/' + user.uid);
                var newPostRef = codesRef.push();
                newPostRef.set({
                    code: message
                });
            }
        }

        function onCliCkCamera() {
            stopping = false;
            const config = {
                fps: 10, // Optional frame per seconds for qr code scanning
                qrbox: 250 // Optional if you want bounded box UI
            };
            html5QrCode.start({
                facingMode: "environment"
            }, config, qrCodeSuccessCallback);
            // If you want to prefer back camera
            $('#stopCamera').show();
            $('#startCamera').hide();
            $('.toolbar').hide();

            $('.toolbar+.page__background+.page__content ').css('top', '0')
            $('#scanned-list').hide()
        }

        function stopCamera() {
            stopping = true;
            html5QrCode.stop().then(ignore => {
                // QR Code scanning is stopped.
            }).catch(err => {
                // Stop failed, handle it.
            });
            $("#reader").empty();
            $('#scanned-list').show()
            $('.toolbar+.page__background+.page__content ').css('top', '44px')
            $('.toolbar').show();
            $('#startCamera').show();
            $('#stopCamera').hide();


        }
    </script>
    <style>
        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
        }
        
        .custom-file-input::before {
            content: 'Scan barcode';
            display: inline-block;
            background: linear-gradient(top, #f9f9f9, #e3e3e3);
            border: 1px solid #999;
            border-radius: 3px;
            padding: 5px 10px;
            outline: none;
            white-space: nowrap;
            -webkit-user-select: none;
            cursor: pointer;
            text-shadow: 1px 1px #fff;
            font-weight: 700;
            font-size: 10pt;
        }
        
        .custom-file-input:hover::before {
            border-color: black;
        }
        
        .custom-file-input:active::before {
            background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9);
        }
    </style>

    <script src="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.0/firebase-ui-auth.css" />
    <script src="https://unpkg.com/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() { // FirebaseUI config.

            // Set the configuration for your app
            // TODO: Replace with your project's config object
            var config = {
                apiKey: "{YOUR_API_KEY}",
                authDomain: "{YOUR_AUTH_DOMAIN}",
                // For databases not in the us-central1 location, databaseURL will be of the
                // form https://[databaseName].[region].firebasedatabase.app.
                // For example, https://your-database-123.europe-west1.firebasedatabase.app
                databaseURL: "{YOUR_DATABASE_URL}/",
                storageBucket: "wasteinfonet.com"
            };
            //            firebase.initializeApp(config);

            logout = function() {
                firebase.auth().signOut();
            }

            loadCodes = function() {
                let user = JSON.parse(localStorage.getItem("user"));
                if (user) {
                    firebase.database().ref('codes/' + user.uid).once('value', (snapshot) => {
                        snapshot.forEach(childSnapshot => {
                            var childData = childSnapshot.val();
                            console.log(childData)
                            let listItem = document.createElement('ons-list-item')
                            listItem.innerHTML = childData.code;
                            document.querySelector('#scanned-list').appendChild(listItem);
                        });
                    })
                }
            };

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(showPosition);
                } else {

                }
            }

            function showPosition(position) {
                localStorage.setItem('latitude', position.coords.latitude)
                localStorage.setItem('longitude', position.coords.longitude)
            }
            updateProfile = function() {
                let user = JSON.parse(localStorage.getItem("user"));

                firebase.database().ref('users/' + user.uid).set({
                    firstname: document.getElementById('Firstname').value,
                    lastname: document.getElementById('Lastname').value,
                    country: document.getElementById('Country').value,
                    city: document.getElementById('City').value,
                    address: document.getElementById('Address').value,
                    age: document.getElementById('Age').value,
                    email: document.getElementById('Email').value,
                    latitude: localStorage.getItem('latitude'),
                    longitude: localStorage.getItem('longitude')
                });
            };

            loadProfile = function() {
                const dbRef = firebase.database().ref();
                let user = JSON.parse(localStorage.getItem("user"));
                if (user) {
                    dbRef.child("users").child(user.uid).get().then((snapshot) => {
                        if (snapshot.exists()) {
                            let profile = snapshot.val();
                            if (profile.firstname !== undefined) {
                                document.getElementById('Firstname').value = profile.firstname
                            }
                            if (profile.lastname !== undefined) {
                                document.getElementById('Lastname').value = profile.lastname
                            }
                            if (profile.country !== undefined) {
                                document.getElementById('Country').value = profile.country
                            }
                            if (profile.city !== undefined) {
                                document.getElementById('City').value = profile.city
                            }
                            if (profile.address !== undefined) {
                                document.getElementById('Address').value = profile.address
                            }
                            if (profile.age !== undefined) {
                                document.getElementById('Age').value = profile.age
                            }
                            if (profile.email !== undefined) {
                                document.getElementById('Postal Code').value = profile.zip
                            }
                        } else {
                            console.log("No data available");
                        }
                    }).catch((error) => {
                        console.error(error);
                    });
                }
            };
            initApp = function() {

                firebase.auth().onAuthStateChanged(function(user) {
                        if (user) {
                            localStorage.setItem('user', JSON.stringify(user));
                            user.getIdToken().then(function(accessToken) {
                                localStorage.setItem('token', JSON.stringify(accessToken));
                            });
                            $('#authorized').show();
                            document.addEventListener('prechange', function(event) {
                                document.querySelector('ons-toolbar .center')
                                    .innerHTML = event.tabItem.getAttribute('label');
                            });
                            $('#firebaseui-auth-container').hide();
                        } else {
                            $('#authorized').hide();
                            $('#firebaseui-auth-container').show();
                        }
                    },
                    function(error) {
                        console.log(error);
                    });
            };
            initApp();
            loadProfile();
            loadCodes();
            getLocation();

            var uiConfig = {
                signInSuccessUrl: '{YOUR_SIGN_IN_URL}',
                signInOptions: [
                    // Leave the lines as is for the providers you want to offer your users.
                    firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                    firebase.auth.EmailAuthProvider.PROVIDER_ID
                ],
                // tosUrl and privacyPolicyUrl accept either url string or a callback
                // function.
                // Terms of service url/callback.
                tosUrl: '<your-tos-url>',
                // Privacy policy url/callback.
                privacyPolicyUrl: function() {
                    window.location.assign('<your-privacy-policy-url>');
                }
            };

            // Initialize the FirebaseUI Widget using Firebase.
            var ui = new firebaseui.auth.AuthUI(firebase.auth());
            // The start method will wait until the DOM is loaded.
            ui.start('#firebaseui-auth-container', uiConfig);
        });
    </script>
</head>

<body>
    <div id="firebaseui-auth-container" style="margin-top:10px">
        <p style="text-align: center;">
            <img src="wasteinfonet-logo.png" alt="logo" class="center" style="width: 50%;">
        </p>
        <h2 style="text-align: center;font-family: Roboto;font-style: normal;font-weight: bold;font-size: 15px;line-height: 150%;
        /* or 18px */letter-spacing: 0.03em;">HOW TO USE THE APP? </h2>
        <ul style="font-family: Roboto;font-style: normal;font-weight: bold;font-size: 8px;line-height: 150%;
        /* or 18px */letter-spacing: 0.03em;     list-style-type: decimal;">
            <li>Register or sign in (email address needed)</li>
            <li>Create a username and password.</li>
            <li>Go to your mail and check for a new mail containing the activation link (Check spam if you did not receive the mail in your inbox).</li>
            <li>Create your Binance Smart Chain wallet if you do not have one and update it in your profile.</br>
                Follow the link below to create your BSC wallet: https://academy.binance.com/en/articles/how-to-get-started-with-binance-smart-chain-bsc </li>
            <li>After registration, check your profile for a referral link you can use to invite friends.</li>
            <li>Scan barcodes of waste packages daily by pressing scan after focusing on the barcode.</li>
            <li>If you need more help contact us in our webpage.</li>
        </ul>
    </div>

    <ons-page id="authorized">
        <ons-tabbar swipeable position="auto">
            <ons-tab page="tab1.html" label="Home" icon="ion-ios-home, material:md-home" active>
            </ons-tab>
            <ons-tab page="tab2.html" label="Scanned" icon="md-menu" active-icon="md-menu">
            </ons-tab>
            <ons-tab page="tab4.html" label="Ewallet" icon="fa-wallet" active-icon="fa-wallet">
                <input type="radio" style="display: none">
                <button class="tabbar__button">
                  <div class="tabbar__icon">
                    <ons-icon icon="fa-wallet"></ons-icon>
                  </div>
                  <div class="tabbar__label">Ewallet</div>
                  <div class="tabbar__badge notification">99</div>
                </button>
            </ons-tab>
            <ons-tab page="tab3.html" label="Settings" icon="md-settings" active-icon="md-settings">
            </ons-tab>
        </ons-tabbar>
    </ons-page>

    <template id="tab1.html">
        <ons-page id="Home">
            <p style="text-align: center;">
            <img src="wasteinfonet-logo.png" alt="logo" class="center" style="width: 50%;">
            </p>
            <ons-list>
                <ons-list-header> 
                    Daily Challenges
                </ons-list-header>
                <ons-list-item>
                    <div class="left">
                        <img src="reward.svg">
                    </div>
                    <div class="center">
                        <span class="list-item__title">Monday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                    </div>
                    <div class="right">
                        <span class="label success">Completed</span>
                    </div>
                </ons-list-item>
                <ons-list-item>
                    <div class="left">
                        <img src="reward-red.svg">
                    </div>
                    <div class="center">
                         <span class="list-item__title">Tuesday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                    </div>
                    <div class="right">
                        <span class="label danger">Incomplete</span>
                    </div>
                </ons-list-item>
                <ons-list-item>
                    <div class="left">
                        <img src="reward-orange.svg">
                    </div>
                    <div class="center">
                        <span class="list-item__title">Tuesday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                    </div>
                    <div class="right">
                        <span class="label warning">Pending</span>
                    </div>
                </ons-list-item>
                <ons-list-header> 
                    Referals
                </ons-list-header>
                <ons-list-item>
                    <div class="left">
                        <img src="referal.svg">
                    </div>
                    <div class="center">
                        <span class="list-item__title">Referal 1</span><span class="list-item__subtitle">150 WIF</span>
                    </div>
                    <div class="right">
                        <span class="label success">Completed</span>
                    </div>
                </ons-list-item>
            </ons-list>
       
        </ons-page>
    </template>

    <template id="tab2.html">
        
      <ons-page id="Scanned">
          <ons-list id="scanned-list">
              <ons-list-header>Scanned products</ons-list-header>
          </ons-list>

        <p style="text-align: center;">
          <input  type="file" id="selectedFile" style="display: none;" accept = "image/*" capture = "environment"/>
          <div id="reader"></div>
            <ons-fab  id="startCamera" position="bottom right" onclick="onCliCkCamera()" >
              <ons-icon icon="md-camera"></ons-icon>
            </ons-fab>
            <ons-fab id="stopCamera" position="bottom right" onclick="stopCamera()"  style="display: none;">
              <ons-icon icon="md-close"></ons-icon>
            </ons-fab>
      
        </p>
      </ons-page>
</template>

    <template id="tab3.html">
      <ons-page id="Settings">
        <div style="text-align: center; margin-top: 30px;">
      <p style="text-align: center;">
        <style>
        .avatar {   
            clip-path: circle(40% at 50% 50%);
            width: 80px;
          }</style>
        <img src="profile.jpg" alt="Avatar" class="avatar">
      </p>
      <p>
        <ons-input id="Firstname" modifier="underbar" placeholder="Firstname" float></ons-input>
      </p>
      <p>
        <ons-input id="Lastname" modifier="underbar" placeholder="Lastname" float></ons-input>
      </p>
      <p>
        <ons-input id="Country" modifier="underbar" placeholder="Country" float></ons-input>
      </p>
      <p>
        <ons-input id="City" modifier="underbar" placeholder="City" float></ons-input>
      </p>
      <p>
        <ons-input id="Address" modifier="underbar" placeholder="Address" float></ons-input>
      </p>
      <p>
        <ons-input id="Age" modifier="underbar"  type="number" placeholder="Age" float></ons-input>
      </p>
      <p>
        <ons-input id="Postal Code" modifier="underbar" placeholder="Postal Code" float></ons-input>
      </p>
      <p>
        <ons-button id="update-profile"  onclick=" updateProfile()">Update Profile</ons-button>
      </p>
      <p>
        <ons-button id="sign-out" modifier="large" onclick="logout()">Logout</ons-button>
      </p>
        </div>
      </ons-page>
</template>
    <style>
        .round-btn {
            margin: auto !important;
            width: 85%;
            text-align: center;
            border-radius: 30px !important;
            font-size: small !important;
            padding: 0px !important;
        }
        
        .balance {
            background: linear-gradient( 180deg, #005CFF 0%, #003594 100%);
            color: white;
            font-size: 24px;
            line-height: 136.19%;
            text-align: center;
            font-weight: bold;
            letter-spacing: 0.03em;
            height: 150px;
            display: block;
        }
    </style>
    <template id="tab4.html">
    <ons-page id="Wallet">
        <div class="balance" >
            <div style="padding-top:35px;">
                <span>YOUR BALANCE</span>
                <span>7500 $</span>
            </div>
            <style>
                .ewallet{
                        width: 90%;
                        padding:5px;
                        margin: auto;
                        margin-top: 15px;
                        background: #FFFFFF;
                        box-shadow: 0px 15px 30px rgb(0 0 0 / 15%);
                        border-radius: 7.5px;
                }
            </style>
            
            <div  class="center" style="position: absolute;width: 100%;top: 105px;"><ons-button class=" round-btn" ><ons-icon icon="fa-university"></ons-icon>Withdraw Money</ons-button></div>
        </div>
        <div class="ewallet">
            <div style="
            font-family: Roboto;
            font-style: normal;
            font-weight: bold;
            font-size: 12px;
            line-height: 136.19%;
            letter-spacing: 0.03em;
        ">
                <p style="
                font-family: Roboto;
                font-style: normal;
                font-weight: bold;
                font-size: 12px;
                line-height: 136.19%;
                letter-spacing: 0.03em;
                color: #1367FB;
            ">YOUR BINANCE EWALLET ADDRESS</p>
                baj54564asfof45aernbASbn4785216DA65ASdf4
            </div>
            <div  class="center" style="position: absolute;width: 100%;top: 105px;"></div><ons-button class="round-btn" style="width: 100%;margin-top: 5px !important;"><ons-icon icon="fa-copy"></ons-icon>Copy Link</ons-button></div>
        </div>
        <ons-list style="margin-top: 15px;">
            <ons-list-header> 
                Daily Challenges
            </ons-list-header>
            <ons-list-item>
                <div class="left">
                    <img src="reward.svg">
                </div>
                <div class="center">
                    <span class="list-item__title">Monday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                </div>
                <div class="right">
                    <span class="label success">Completed</span>
                </div>
            </ons-list-item>
            <ons-list-item>
                <div class="left">
                    <img src="reward-red.svg">
                </div>
                <div class="center">
                     <span class="list-item__title">Tuesday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                </div>
                <div class="right">
                    <span class="label danger">Incomplete</span>
                </div>
            </ons-list-item>
            <ons-list-item>
                <div class="left">
                    <img src="reward-orange.svg">
                </div>
                <div class="center">
                    <span class="list-item__title">Tuesday Reward Challange</span><span class="list-item__subtitle">10 WIF</span>
                </div>
                <div class="right">
                    <span class="label warning">Pending</span>
                </div>
            </ons-list-item>
            <ons-list-header> 
                Referals
            </ons-list-header>
            <ons-list-item>
                <div class="left">
                    <img src="referal.svg">
                </div>
                <div class="center">
                    <span class="list-item__title">Referal 1</span><span class="list-item__subtitle">150 WIF</span>
                </div>
                <div class="right">
                    <span class="label success">Completed</span>
                </div>
            </ons-list-item>
        </ons-list>
   
    </ons-page>
</template>

</body>
<link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
<link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
<script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>


</html>
<link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
<link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
<script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
<style>
    .page__content {
        background-color: white !important;
    }
    
    .label {
        color: white;
        padding: 2px;
        border-radius: 100px;
        width: 75px;
        font-size: smaller;
        text-align: center;
    }
    
    .success {
        background-color: rgba(69, 255, 38, 0.15);
        color: #1CC500;
    }
    /* Green */
    
    .info {
        background-color: #2196F3;
    }
    /* Blue */
    
    .warning {
        background-color: rgba(255, 122, 0, 0.15);
        color: #FF7A00;
    }
    /* Orange */
    
    .danger {
        background-color: rgba(255, 64, 38, 0.15);
        color: #FF4444;
    }
    /* Red */
    
    .other {
        background-color: #e7e7e7;
        color: black;
    }
    /* Gray */
</style>

</html>